#!/usr/bin/env ruby

# Simple script for dumping a specified pallet as YAML.

require 'palletjack'
require 'optparse'

options = {:type => "system"}

opts = OptionParser.new
opts.banner = "Usage: #{$PROGRAM_NAME} [options] <name> ...

Dump the YAML representation of all named pallets in a Palletjack warehouse

"
opts.on("-w DIR", "--warehouse DIR", "warehouse directory", String) {|dir| options[:warehouse] = dir }
opts.on("-t TYPE", "--type TYPE", "type (default \"system\")", String) {|type| options[:type] = type }
opts.parse!

if not options[:warehouse] or
    ARGV.length == 0
  puts opts.to_s
  exit 1
end

if ARGV.length == 0
  puts opts.to_s
  exit 2
end

jack = PalletJack.new(options[:warehouse])

# Since we used the destructive opts.parse! above, all options were
# removed from ARGV, leaving just the names to search for.
ARGV.each {|name|
  pallets = jack[options[:type], name:name]
  if pallets.length == 0
    puts "No \"#{options[:type]}\" named \"#{name}\" found."
    next
  end
  pallets.each {|p| puts p.to_yaml}
}
